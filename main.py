from telethon import TelegramClient, events
import re


api_id = 27272508
api_hash = "fd910ebdfc761b86e5e2f143d71f45c0"
phone = "380507478894"

client = TelegramClient(phone, api_id, api_hash, system_version='4.16.30-vxCUSTOM')
client.parse_mode = 'html'

main_channel = -1001998091404

channels_for_grab = [
    -1001606401919, -1001949005395, -1001295005098, -1001660722954, -1001857132617, -1001322813943, -1001604013421,
    -1001350832778, -1001581519471, -1001177079955, -1001277862355, -1001325190160, -1001181579326, -1001543510066,
    -1001791271427, -1001389837789, -1001896345357, -1001233154810, -1001318459173, -1001983684965, -1001517199518,
    -1001786005753, -1001685123337, -1001529532603, -1001393712717, -1001674186593, -1001576305880, -1001751525601,
    -1001811247070, -1001371916046, -1001525543664, -1001290983142, -1001579208217, -1001673787979, -1001553038207,
    -1001244592602, -1001833426987, -1001904339991, -1001961266885, -1001380511806, -1002087504613, -1001450269392,
    -1001995902277, -1001583799495, -1001396331355, -1001769678468, -1001468922843, -1001452023334, -1001408008774,
    -1001209877193, -1001409517037, -1001401726033, -1001393249193, -1001180245715, -1001759178932, -1001308407014,
    -1001311408644, -1001988560722, -1001322813943, -1001438469067, -1001378319048, -1001137503644, -1001522112065,
    -1001958603264, -1001858407380, -1001901167371, -1001942218573, -1001986901421, -1001686223985, -1001536750942,
    -1001522404640, -1001279988735, -1001577681416, -1001683229213, -1001103156398, -1001424234017, -1001442869570,
    -1001140753536, -1001423054913, -1001729965353, -1001381656711, -1001086942006, -1001207633109, -1001576902190,
    -1001422370788, -1001301307794, -1001643644995, -1001539612839, -1001356440450, -1001242700456, -1001711204716,
    -1001649965876, -1001326163489, -1001867981813, -1002048467477, -1001900586453, -1001900312562, -1001851528268,
    -1001851528268, -1001648110014, -1001387780004, -1001882052882, -1001966452863, -1001841275366, -1001231491534,
    -1001493720845, -1001735416346, -1001971870226, -1001626816653, -1001780713808, -1001446774454, -1001165905101,
    -1002081301410, -1001266391544, -1001998091404, -1001630692598, -1002071167364, -1001628904309, -1002081093102,
    -1001411960688, -1001501551131, -1001742443873, -1001911327646, -1002126889584, -1001344723295, -1001703968875,
    -1001783089462, -1002092598460, -1001744248528, -1001811247070, -1001907137791, -1001921958123,
    -1001318459173 - 1001967244124, -1001603058549, -1001995528971, -1001718809245, -1001642613337, -1001700979910,
    -1002058207944, -1001266391544, -1001546754435, -1002108673713, -1001983684965]



async def check_links(text):
    words = ['t.me/']
    chk_pat = '(?:{})'.format('|'.join(words))
    return bool(re.search(chk_pat, text, flags=re.I))


@client.on(events.NewMessage(chats=channels_for_grab))
async def my_event_handler(event):
    text = str(event.message.text)
    check_linkss = await check_links(text)
    if check_linkss:
        if event.message:
            try:
                # await client.send_file(main_channel, file=event.message, caption=text)
                await client.forward_messages(main_channel, messages=event.message)
            except TypeError:
                try:
                    await client.send_file(main_channel, file=event.message, caption=text)
                except:
                    try:
                        await client.send_message(main_channel, text)
                    except:
                        pass
    else:
        return

client.start()
client.run_until_disconnected()
